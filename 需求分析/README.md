# 建筑喷涂施工机器人需求分析文档索引

## 文档概述

本目录包含建筑喷涂施工机器人分布式控制系统的完整需求分析文档。

**项目名称**：建筑喷涂施工机器人分布式控制系统

**硬件平台**：Adafruit QT Py ESP32-C3（7个独立节点）

**系统架构**：分布式单一职责节点架构

**开发环境**：VS Code + PlatformIO + ESP-IDF

**文档版本**：v2.0.0

**最后更新**：2025-10-23

---

## 🤖 项目背景

### 应用场景

本系统面向建筑施工行业，专注于墙面喷涂作业自动化：
- **施工对象**：石膏、腻子、乳胶漆等墙面材料
- **作业方式**：自动喷涂、均匀覆盖、厚度控制
- **工作环境**：室内外建筑施工现场

### 系统组成

**机器人平台**：
- 差速移动底盘（自研）
- 垂直升降机构（自研，伺服驱动）
- 六轴协作机械臂（法奥意威，外采）
- 喷涂执行器（喷枪+供料系统）

**控制系统**：
- 7个ESP32-C3节点（分布式架构）
- ROS 2 Humble通信
- WiFi网络互联
- 上位机工控机

---

## 🏗️ 分布式节点架构

### 核心设计原则：单一职责

每个ESP32-C3节点专注于管理**单一类型**的传感器或执行器：

| 节点编号 | 节点名称 | 单一职责 | 硬件平台 |
|---------|---------|---------|---------|
| **NODE-01** | 底盘控制节点 | 差速轮电机+编码器 | QT Py ESP32-C3 |
| **NODE-02** | 升降机构节点 | 伺服电机+位置传感器 | QT Py ESP32-C3 |
| **NODE-03** | 环境监测节点 | 温湿度气压传感器 | QT Py ESP32-C3 |
| **NODE-04** | 喷涂监控节点 | 压力流量料位传感器 | QT Py ESP32-C3 |
| **NODE-05** | 距离测量节点 | 墙面距离传感器×4 | QT Py ESP32-C3 |
| **NODE-06** | IMU姿态节点 | IMU传感器 | QT Py ESP32-C3 |
| **NODE-07** | 电源管理节点 | 电池监测 | QT Py ESP32-C3 |

### 架构优势

✅ **故障隔离**：单节点故障不影响其他节点运行
✅ **易于维护**：每个节点代码独立，便于调试和更新
✅ **负载均衡**：多节点分担计算和通信压力
✅ **易于扩展**：可方便添加新节点（激光雷达、视觉识别等）
✅ **并行开发**：不同节点可由不同工程师并行开发

---

## 📚 文档清单

### 1. 核心需求文档

#### 📋 [项目需求规格说明书](./项目需求规格说明书.md)
**文件**：`项目需求规格说明书.md`

**描述**：项目的核心需求文档，针对施工机器人场景全面重构。

**主要章节**：
- **第1章：项目概述**
  - 建筑施工行业痛点分析
  - 机器人系统组成（底盘+升降+机械臂+传感器）
  - 分布式节点架构设计
  - 核心价值和商业价值
- **第2章：硬件节点定义**
  - **2.0节：Adafruit QT Py ESP32-C3硬件资源**
    - 完整GPIO接口清单（GPIO0-10, GPIO20-21）
    - 板载硬件说明（Type-C、Reset、Boot、OLED）
    - 接口资源分配约束和策略
  - 2.1-2.7节：7个节点的详细定义
    - 节点职责、硬件接口、ROS接口
    - 性能指标、应用场景
- **第3章：通用功能需求**
  - ROS通信接口规范
  - 配置管理（Menuconfig + NVS）
  - 异常处理和故障恢复
- **第4章：非功能需求**
  - 性能需求（实时性、吞吐量、资源占用）
  - 可靠性需求（连续运行、环境适应）
  - 兼容性需求（ROS版本、上位机平台）
  - 安全性需求（网络安全、作业安全）
- **第5章：开发与交付约束**

**适用人员**：项目经理、硬件工程师、嵌入式工程师、ROS工程师

**关键改进**：
- ✅ 根据实际GPIO资源重新分配硬件接口
- ✅ 考虑GPIO5-6被OLED占用的约束
- ✅ 优化I2C设备使用，节省GPIO资源
- ✅ 添加128x64 OLED状态显示功能
- ✅ 完整的硬件接口资源说明

---

### 2. 接口定义文档

#### 🔌 [ROS接口定义文档](./ROS接口定义文档.md)
**文件**：`ROS接口定义文档.md`

**描述**：完整的ROS 2接口定义，为7个节点分别定义通信接口。

**主要内容**：
- **第1章：系统架构概述**
  - 分布式节点拓扑图
  - 节点命名规范
  - 通信特点说明
- **第2-8章：各节点接口定义**
  - 底盘控制节点（`/chassis/*`）
  - 升降机构节点（`/lift/*`）
  - 环境监测节点（`/environment/*`）
  - 喷涂监控节点（`/spray/*`）
  - 距离测量节点（`/range/*`）
  - IMU姿态节点（`/imu/*`）
  - 电源管理节点（`/battery/*`）
- **第9章：QoS配置规范**
  - 预定义QoS配置文件
  - 参数选择策略
- **第10章：命名规范**
  - 话题、服务、坐标系命名规范
- **第11章：使用示例**
  - 完整的命令行示例
  - 系统监控方法

**特点**：
- 详细的消息结构定义（YAML格式）
- 每个话题都标注了发布频率和QoS配置
- 完整的ROS 2命令行使用示例
- 遵循ROS标准消息类型（sensor_msgs、nav_msgs等）

**适用人员**：ROS系统工程师、上位机应用开发、集成测试工程师

---

### 3. 功能需求细化文档

#### ✅ [功能需求清单](./功能需求清单.md)
**文件**：`功能需求清单.md`

**状态**：⚠️ 待更新（需要根据7个节点重新组织需求条目）

**建议结构**：
- 按节点组织需求（每个节点一个章节）
- 每个节点包含：传感器/执行器功能、通信功能、配置功能、异常处理
- 统一的需求编号格式：`REQ-<NODE>-<CATEGORY>-<ID>`
  - 示例：`REQ-CHASSIS-CTRL-001`（底盘控制需求）
  - 示例：`REQ-LIFT-SENSOR-001`（升降传感器需求）

---

### 4. 配置管理文档

#### ⚙️ [Menuconfig配置项说明](./Menuconfig配置项说明.md)
**文件**：`Menuconfig配置项说明.md`

**状态**：⚠️ 待更新（需要为每个节点定义专属配置项）

**建议结构**：
- **通用配置**：WiFi、ROS Agent、日志级别（所有节点共用）
- **节点专属配置**：每个节点独立的配置章节
  - 底盘节点：电机参数、PID系数、编码器参数
  - 升降节点：伺服参数、限位设置、速度范围
  - 环境节点：传感器类型、采样频率、报警阈值
  - 喷涂节点：压力范围、流量校准、料位阈值
  - 距离节点：传感器类型（激光/超声波）、测量范围
  - IMU节点：采样频率、量程、校准参数
  - 电源节点：电池类型、容量、报警阈值

---

## 🔧 硬件接口资源

### Adafruit QT Py ESP32-C3规格

**芯片**：ESP32-C3 (RISC-V, 160MHz)
**内存**：400KB RAM, 4MB Flash
**无线**：WiFi 802.11 b/g/n (2.4GHz)

**GPIO资源**：

| GPIO | 功能 | 约束 | 典型用途 |
|------|------|------|---------|
| GPIO0-4 | ADC1_CH0-4 | 12位ADC | 模拟传感器、PWM输出 |
| GPIO5-6 | I2C/SPI | **已用OLED** | 128x64显示屏 |
| GPIO7 | SPI_SS | 可用 | 通用GPIO |
| GPIO8-9 | I2C | **主总线** | 连接I2C传感器 |
| GPIO10 | GPIO | 可用 | 通用输入/输出 |
| GPIO20-21 | UART | 调试串口 | USB-CDC日志 |

**电源**：
- 5V (Type-C输入)
- 3.3V (稳压输出，600mA max)
- GND

**板载硬件**：
- Type-C接口（USB通信+供电）
- Reset按钮（MCU复位）
- Boot按钮（固件下载模式）
- **128x64 OLED**（所有节点可显示状态）
- NeoPixel LED（状态指示）

### 接口分配策略

**关键约束**：
1. GPIO5-6被OLED占用（但所有节点都可以使用显示）
2. 仅有GPIO0-4可用作ADC（5个通道）
3. I2C总线（GPIO8-9）可连接多个设备（通过不同地址或多路复用器）
4. 数字GPIO非常有限（仅GPIO7和GPIO10）

**优化策略**：
- ✅ **优先使用I2C设备**：BME280、AS5600、VL53L0X、MPU6050、INA219等
- ✅ **I2C多路复用**：使用TCA9548A连接多个相同地址设备
- ✅ **ADC用于模拟传感器**：压力、电压、电流等
- ✅ **PWM复用ADC引脚**：GPIO0-4可输出PWM控制电机
- ✅ **OLED共享使用**：所有节点都可以显示自己的状态信息

---

## 📊 文档统计

| 文档名称 | 页数估算 | 主要内容 | 更新状态 |
|---------|---------|---------|---------|
| 项目需求规格说明书 | 70页 | 7节点定义+通用需求+非功能需求 | ✅ 已更新v2.0 |
| ROS接口定义文档 | 50页 | 7节点ROS接口+使用示例 | ✅ 已更新v2.0 |
| 功能需求清单 | 30页 | 按节点组织的需求条目 | ⚠️ 待更新 |
| Menuconfig配置项说明 | 40页 | 节点专属配置项 | ⚠️ 待更新 |
| **总计** | **约190页** | - | - |

---

## 🎯 文档使用指南

### 硬件工程师

**推荐阅读顺序**：
1. [项目需求规格说明书](./项目需求规格说明书.md) - 第2.0节（硬件接口资源）
2. [项目需求规格说明书](./项目需求规格说明书.md) - 第2.1-2.7节（各节点硬件接口）

**关注重点**：
- GPIO资源分配和约束
- 传感器/执行器选型
- 电源管理方案
- 接口兼容性

---

### 嵌入式开发工程师

**推荐阅读顺序**：
1. [项目需求规格说明书](./项目需求规格说明书.md) - 完整阅读
2. [ROS接口定义文档](./ROS接口定义文档.md) - 对应节点章节
3. Menuconfig配置项说明 - 节点专属配置

**关注重点**：
- 节点职责定义
- 硬件接口驱动实现
- ROS话题和服务实现
- 异常处理逻辑
- Menuconfig配置项

---

### ROS系统工程师

**推荐阅读顺序**：
1. [ROS接口定义文档](./ROS接口定义文档.md) - 完整阅读
2. [项目需求规格说明书](./项目需求规格说明书.md) - 第3章（通用功能需求）

**关注重点**：
- 话题和服务定义
- 消息数据结构
- QoS配置策略
- 命名规范
- 坐标系变换

---

### 机器人工程师

**推荐阅读顺序**：
1. [项目需求规格说明书](./项目需求规格说明书.md) - 第1、2章
2. [ROS接口定义文档](./ROS接口定义文档.md) - 底盘、升降、IMU节点

**关注重点**：
- 运动控制接口
- 里程计和姿态数据
- 传感器融合方案
- 安全保护机制

---

## 🔄 文档版本管理

### 版本号规则

`vMAJOR.MINOR.PATCH`
- **MAJOR**：架构重大变更（1.x → 2.0 分布式架构）
- **MINOR**：节点或功能增减
- **PATCH**：文档修正、格式优化

**当前版本**：v2.0.0

### 变更记录

| 版本 | 日期 | 变更类型 | 变更描述 | 变更人 |
|------|------|---------|---------|--------|
| v2.0.0 | 2025-10-23 | 架构重构 | 改为施工机器人7节点分布式架构 | - |
| v2.0.0 | 2025-10-23 | 硬件适配 | 根据QT Py ESP32-C3实际GPIO重新分配接口 | - |
| v1.0.0 | 2025-10-23 | 初始版本 | 通用传感器节点文档 | - |

---

## 📞 常见问题

### Q1：为什么选择分布式架构而不是单片机集中式？

**A**：分布式架构的优势：
- **故障隔离**：单节点故障不影响系统
- **开发并行**：多人可同时开发不同节点
- **维护简单**：节点独立，易于调试和更换
- **扩展方便**：可随时添加新节点（如视觉、激光雷达）
- **负载均衡**：避免单片机性能瓶颈

### Q2：GPIO资源这么少，如何连接这么多传感器？

**A**：通过以下策略优化：
1. **I2C总线共享**：多个I2C设备共用GPIO8-9（通过不同地址）
2. **I2C多路复用器**：TCA9548A支持8个相同地址设备
3. **智能传感器模块**：使用集成I2C接口的模块（如DRV8833电机驱动+编码器）
4. **模拟信号共用ADC**：GPIO0-4可连接5个模拟传感器
5. **OLED共享**：所有节点都可以使用板载显示屏

### Q3：所有节点都有OLED，如何显示不同内容？

**A**：每个节点独立运行，板载OLED显示本节点状态：
- 底盘节点：显示速度、里程、电机状态
- 升降节点：显示当前高度、目标高度
- 环境节点：显示温湿度、适宜性判断
- 喷涂节点：显示压力、流量、料位
- 距离节点：显示四个方向距离
- IMU节点：显示姿态角、倾斜警告
- 电源节点：显示电压、电量、续航时间

### Q4：7个节点如何通信？

**A**：通过WiFi + ROS 2网络：
1. 所有节点连接同一WiFi网络
2. 连接到上位机的Micro-ROS Agent
3. 通过ROS话题发布/订阅数据
4. 通过ROS服务调用进行配置和控制
5. Domain ID隔离不同机器人系统

### Q5：如何保证实时性？

**A**：
- **网络优化**：使用WiFi 5GHz频段（如果硬件支持）或专用路由器
- **QoS配置**：关键控制指令使用RELIABLE，高频数据使用BEST_EFFORT
- **本地闭环**：电机PID控制在节点本地完成，不依赖ROS
- **优先级调度**：关键任务使用高优先级FreeRTOS任务
- **性能监控**：实时监控通信延迟和丢包率

---

## 🛠️ 相关资源

### 外部文档链接

- [ESP-IDF编程指南](https://docs.espressif.com/projects/esp-idf/zh_CN/latest/)
- [Micro-ROS官方文档](https://micro.ros.org/)
- [ROS 2 Humble文档](https://docs.ros.org/en/humble/)
- [PlatformIO文档](https://docs.platformio.org/)
- [Adafruit QT Py ESP32-C3](https://www.adafruit.com/product/5405)

### 项目内部文档

- [硬件连接指南](../docs/HARDWARE_CONNECTION.md)
- [架构设计文档](../docs/PLATFORMIO_ARCHITECTURE_DESIGN.md)
- [项目状态](../docs/PROJECT_STATUS.md)
- [项目README](../README.md)

---

## ✨ 文档特色

### 1. 针对性强
- 完全针对建筑喷涂施工机器人场景
- 7个节点分别定义，职责清晰
- 考虑实际GPIO资源约束

### 2. 完整性
- 从系统架构到接口定义
- 从硬件连接到软件配置
- 从功能需求到非功能需求

### 3. 实用性
- 提供详细的硬件接口分配
- 包含丰富的ROS命令示例
- 附带配置文件示例

### 4. 可维护性
- Markdown格式，易于阅读
- 模块化文档结构
- 完善的交叉引用

---

**最后更新时间**：2025-10-23

**文档状态**：✅ v2.0已完成项目需求规格说明书和ROS接口定义文档

**下一步工作**：
1. 更新功能需求清单（按7个节点重新组织）
2. 更新Menuconfig配置项说明（添加节点专属配置）
3. 编写节点部署指南（硬件连接、固件烧录、配置步骤）
4. 编写系统集成测试方案